                                                                        --DBMS CASE STUDY-- --Car Rental Management Sytem--
create table cars (
  car_id int not null primary key,
  make varchar(255) not null,
  model varchar(255) not null,
  year int not null,
  license_plate_number varchar(255) not null,
  vin varchar(255) not null,
  color varchar(255) not null,
  mileage int not null,
  condition varchar(255) not null,
  rental_rate_per_day decimal(10,2) not null
);

create table customers (
  customer_id int not null primary key,
  name varchar(255) not null,
  address varchar(255) not null,
  phone_number varchar(255) not null,
  email_address varchar(255) not null,
  driver_s_license_number varchar(255) not null,
  credit_card_information varchar(255) not null
);


create table locations (
  location_id int not null primary key,
  address varchar(255) not null,
  phone_number varchar(255) not null,
  email_address varchar(255) not null,
  hours_of_operation varchar(255) not null
);


create table reservations (
  reservation_id int not null primary key,
  customer_id int not null,
  car_id int not null,
  pick_up_date varchar(12) not null,
  drop_off_date varchar(12) not null,
  location_id int not null,
  rental_rate decimal(10,2) not null,
  status varchar(255) not null,
  foreign key (customer_id) references customers(customer_id),
  foreign key (car_id) references cars(car_id),
  foreign key (location_id) references locations(location_id)
);



create table employees (
  employee_id int not null primary key,
  name varchar(255) not null,
  address varchar(255) not null,
  phone_number varchar(255) not null,
  email_address varchar(255) not null,
  job_title varchar(255) not null
);


select * from cars;
select * from customers;
select * from reservations;
select * from locations;
select * from employees;




insert into cars (car_id, make, model, year, license_plate_number, VIN, color, mileage, condition, rental_rate_per_day) VALUES (1, 'Honda', 'Civic', 2023, 'ABC123', '1234567890ABCDEF', 'Red', 10000, 'Excellent', 100.00);

insert into customers (customer_id, name, address, phone_number, email_address, driver_s_license_number, credit_card_information) VALUES (1, 'John Doe', '123 Main Street', '123-456-7890', 'john.doe@example.com', 'ABC1234567890', '1234-5678-9012-3456');

insert into reservations (reservation_id,customer_id,car_id,pick_up_date, drop_off_date, location_id, rental_rate, status) VALUES (1,1,1,'2023-11-04','2023-11-07',1,100.00,'Pending');

insert into locations (location_id, address, phone_number, email_address, hours_of_operation) VALUES (1, '123 Main Street', '123-456-7890', 'info@location1.com', '9am-5pm, 7 days a week');

insert into employees (employee_id, name, address, phone_number, email_address, job_title) VALUES (1, 'Alice Smith', '123 Main Street', '123-456-7890', 'alice.smith@example.com', 'Manager');





--BASIC SQL QUERIES
--1 Get all cars as per rental rates
select * from cars order by rental_rate_per_day desc;


--2 Find all customer details who didn't drop the vehicle on same day
select * from customers
inner join reservations ON customers.customer_id = reservations.customer_id
where reservations.pick_up_date <= drop_off_date;


--3 Get total revenue generated by customers who didn't drop the vehicle on same day
select SUM(rental_rate) AS total_revenue
from reservations
where reservations.pick_up_date <= drop_off_date;


--4 Get the total number of reservations
select COUNT(customer_id) 
from reservations;


--5 Get all loctaions of rentals along with email,address
select distinct location_id,email_address,address
from locations 
where location_id is not null 
order by location_id asc;


--6 Get average rental rate of the all rental locations
select location_id, AVG(rental_rate) AS avg_rental_rate
from reservations
group by location_id
order by location_id asc;


--7 Get the details of the customer/s who rented a car on specific date
select * from cars
where car_id in (select car_id from reservations where pick_up_date = '2022-01-28');


--8 Print all tables
select * from cars;
select * from customers;
select * from reservations;
select * from locations;
select * from employees;





--NESTED QUERIES
--1 Find the customer/s who a car for above the given rental rate:
select *
from customers c
where c.customer_id in (select r.customer_id from reservations r where rental_rate>700);



--2 Get all the cars with good condition:
select car_id, make, model, year, license_plate_number, VIN, color, mileage, condition, rental_rate_per_day
from cars c
where c.condition in (select c.condition from cars c where c.condition = 'Good');





--SET OPERATORS
--1 Find all cars that are available for rent on a specific date:
select car_id
from cars
where car_id not in (select car_id from reservations where pick_up_date = '2023-11-04')
union
select car_id
from reservations
where customer_id = 1;


--2 Find all cars that are rented by customers based on colors:
select car_id
from cars
where color = 'maroon' AND car_id > 0
union all
select car_id
from cars
where color = 'yellow' AND car_id > 0;


--3 Find all common cars that are available for rent on a specific date and that are also have a specific color:
select car_id
from cars
where car_id not in (select car_id from reservations where pick_up_date = '2023-11-04')
intersect
select car_id
from cars
where color ='yellow';


--4 Find all cars that are available for rent on a specific date but not having a specific color:
select car_id
from cars
where car_id not in (select car_id from reservations where pick_up_date = '2023-11-04')
minus
select car_id
from cars
where color ='yellow' or color ='maroon' or color ='pink' or color ='silver';



--5 Find all cars that are not available for rent on a specific date, or that are rented by a specific customer/s, or that are rented by an specific color:
select car_id
from cars
where car_id in (select car_id from reservations where pick_up_date = '2023-11-04')
union all
select car_id
from reservations
where customer_id = 1
union all
select car_id
from cars
where color ='yellow' or color ='maroon' or color ='pink' or color ='silver';

